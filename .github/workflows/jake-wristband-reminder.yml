name: Jake Wristband Reminder

on:
  schedule:
    # December 5th, 2025 - Every 5 minutes from 4:45am to 6:00am Melbourne time
    # 4:45 AM = 5:45 PM UTC Dec 4
    - cron: '45 17 4 12 *'
    # 4:50 AM = 5:50 PM UTC Dec 4
    - cron: '50 17 4 12 *'
    # 4:55 AM = 5:55 PM UTC Dec 4
    - cron: '55 17 4 12 *'
    # 5:00 AM = 6:00 PM UTC Dec 4
    - cron: '0 18 4 12 *'
    # 5:05 AM = 6:05 PM UTC Dec 4
    - cron: '5 18 4 12 *'
    # 5:10 AM = 6:10 PM UTC Dec 4
    - cron: '10 18 4 12 *'
    # 5:15 AM = 6:15 PM UTC Dec 4
    - cron: '15 18 4 12 *'
    # 5:20 AM = 6:20 PM UTC Dec 4
    - cron: '20 18 4 12 *'
    # 5:25 AM = 6:25 PM UTC Dec 4
    - cron: '25 18 4 12 *'
    # 5:30 AM = 6:30 PM UTC Dec 4
    - cron: '30 18 4 12 *'
    # 5:35 AM = 6:35 PM UTC Dec 4
    - cron: '35 18 4 12 *'
    # 5:40 AM = 6:40 PM UTC Dec 4
    - cron: '40 18 4 12 *'
    # 5:45 AM = 6:45 PM UTC Dec 4
    - cron: '45 18 4 12 *'
    # 5:50 AM = 6:50 PM UTC Dec 4
    - cron: '50 18 4 12 *'
    # 5:55 AM = 6:55 PM UTC Dec 4
    - cron: '55 18 4 12 *'
    # 6:00 AM = 7:00 PM UTC Dec 4
    - cron: '0 19 4 12 *'
  
  workflow_dispatch: # Allows manual testing

jobs:
  remind-jake:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Wristband Reminder
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "Reminding Jake about his wristband..."
        
        python3 << 'PYTHON_SCRIPT'
        import json
        import urllib.request
        import urllib.parse
        import os
        from datetime import datetime, timezone, timedelta
        
        # Get secrets from environment
        bot_token = os.environ['TELEGRAM_BOT_TOKEN']
        chat_id = os.environ['TELEGRAM_CHAT_ID']
        
        # Get current Melbourne time
        melbourne_offset = timedelta(hours=11)
        melbourne_tz = timezone(melbourne_offset)
        now_melbourne = datetime.now(timezone.utc).astimezone(melbourne_tz)
        current_hour = now_melbourne.hour
        current_minute = now_melbourne.minute
        
        # Morning reminders (4:45am-6:00am) - ABSOLUTE CHAOS (16 messages)
        morning_reminders = [
            "â° JAKE WAKE UP! WRISTBAND CHECK! DO YOU HAVE IT?! (Time to Face The Music...literally)",
            "ðŸš¨ JAKE! WRISTBAND! CHECK YOUR POCKET! CHECK YOUR BAG! (We're on the Highway to Hell if you forgot it)",
            "â€¼ï¸ MATE. WRISTBAND. NOW. Don't make me come over there! (You Shook Me All Night Long but did you pack your wristband?!)",
            "ðŸŽª JAKE FOR F*CK'S SAKE CHECK YOU HAVE YOUR WRISTBAND! (Don't Stop Me Now... from checking your wristband!)",
            "ðŸ’€ WRISTBAND STATUS: ??? JAKE STATUS: QUESTIONABLE. CONFIRM YOU HAVE IT! (Should I Stay or Should I Go... depends on that wristband mate)",
            "ðŸ”¥ JAKE! WRISTBAND IN HAND OR WE'RE SCREWED! (Every Breath You Take... make sure you're holding that wristband)",
            "ðŸ˜± JAKE THIS IS NOT A DRILL! WRISTBAND! SHOW ME THE WRISTBAND! (Come Together... with your f*cking wristband!)",
            "ðŸ†˜ JAKE! IF YOU DON'T HAVE THAT WRISTBAND I SWEAR TO GOD! (We're Not Gonna Take It... without your wristband!)",
            "ðŸš¨ðŸš¨ðŸš¨ EMERGENCY WRISTBAND CHECK! JAKE! RESPOND! DO YOU HAVE IT?! (Under Pressure... to remember your wristband!)",
            "âš ï¸ JAKE! WRISTBAND OR BUST! SERIOUS NOW MATE! (I Still Haven't Found What I'm Looking For... YOUR WRISTBAND!)",
            "ðŸ’¥ JAKE WHERE IS THE F*CKING WRISTBAND?! TELL ME YOU HAVE IT! (Smells Like Teen Spirit... or panic if you forgot it!)",
            "ðŸ”´ MATE THIS IS GETTING RIDICULOUS! WRISTBAND! NOW! (Back In Black... because you'll be back home without a wristband!)",
            "ðŸ’¢ JAKE I'M NOT JOKING ANYMORE! WRISTBAND CONFIRMATION REQUIRED! (Bohemian Rhapsody... is this the real life or did you forget your wristband?!)",
            "â˜ ï¸ LAST CHANCE JAKE! WRISTBAND! WHERE IS IT?! (Another One Bites The Dust... like your festival plans without a wristband!)",
            "ðŸ†˜ðŸ†˜ðŸ†˜ ABSOLUTE FINAL WARNING! JAKE! WRISTBAND! (Stairway to Heaven... or highway to hell without your wristband!)",
            "ðŸš¨ðŸš¨ðŸš¨ JAKE IF YOU DON'T HAVE THAT WRISTBAND WE'RE F*CKED! (Welcome to the Jungle... without a wristband you're not welcome anywhere!)",
        ]
        
        # Determine which message to send based on time
        # Create a simple mapping based on hour and minute
        time_key = (current_hour, current_minute)
        
        # Morning reminders mapping (hour, minute) -> index
        morning_times = [
            (4, 45), (4, 50), (4, 55),  # 4:45-4:55
            (5, 0), (5, 5), (5, 10), (5, 15), (5, 20), (5, 25), (5, 30), (5, 35), (5, 40), (5, 45), (5, 50), (5, 55),  # 5:00-5:55
            (6, 0)  # 6:00
        ]
        
        # Find which message to send
        if time_key in morning_times:
            index = morning_times.index(time_key)
            message = morning_reminders[index]
        else:
            # Fallback (shouldn't happen but just in case)
            message = "ðŸŽ¸ JAKE! WRISTBAND! (This message arrived at an unexpected time but the point stands!)"
        
        # Send to Telegram
        telegram_url = f"https://api.telegram.org/bot{bot_token}/sendMessage"
        data = urllib.parse.urlencode({
            'chat_id': chat_id,
            'text': message,
            'disable_web_page_preview': True
        }).encode()
        
        req = urllib.request.Request(telegram_url, data=data)
        
        try:
            with urllib.request.urlopen(req) as response:
                result = json.loads(response.read())
                if result.get('ok'):
                    print(f"âœ… Wristband reminder sent to Jake at {now_melbourne.strftime('%I:%M %p')}!")
                else:
                    print(f"Telegram error: {result}")
        except Exception as e:
            print(f"Error sending to Telegram: {e}")
            exit(1)
        PYTHON_SCRIPT
